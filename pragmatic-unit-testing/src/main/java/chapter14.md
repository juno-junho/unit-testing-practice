# 14장. 프로젝트에서 테스트

팀원들과 프로젝트를 진행하면서 조율이 필요하다.

팀 동료는 테스트 코드를 작성하지 않고 훨씬 빨리 코드를 만들 수 있다.

혹은 마감 시간이 다가올 때 팀에서 마감을 맞추는 유일한 방법은 모든 보호장치(테스트)를 거두는 것이라고 말할 수도 있다.

할 수 있는 것은 협상 뿐이다.

단위 테스트는 품질 통제의 일부가 된다.

어떤 개발자는 TDD를 주장하고, 다른 사람들은 필요하다고 느낀 테스트에서만 단위 테스트를 주장할 것이다.

일부 개발자들은 다수의 케이스를 단일 테스트 메서드로 몰아 넣기를 선호할 수도 있따.

느린 통합 테스트를 선호하기도 한다.

**중요한 것은 팀이 같은 편이 되는 것이다. 오랜 언쟁은 다른 사람의 시간을 빼앗는 일이 되기에 적어도 어떤 것에는 동의하고 합의점을 늘려나가는 방향으로 시작해야한다.**

**[단위 테스트 표준 만들기]**

- 개발자들은 어떤 것이 모든 사람의 시간을 많이 낭비하게 만든다 느끼나요
- 모두가 빠르게 동의 할 수 있는 단순한 표준은 무엇인가요

토론 → 회의를 진행해 기대 사항 적는것에 멈추면 안된다.

**표준들 위에서 지속할 필요가 있고, 표준들을 다시 살피고 수정해야한다.**

목록은 다음과 같다.

- 코드를 체크인 하기 전, 어떤 테스트를 실행해야 할지 여부
- 테스트 클래스와 메서드 이름 짓는 방식
- 어떤 라이브러리로 테스트 할지
- AAA 사용 여부
- 선호하는 Mock 도구 선택
- 체크인 테스트 실행 시 콘솔에 출력 허용 할지 여부
- 단위 테스트 스위트에서 느린 테스트를 분명하게 식별하고 막을 방법

이런 표준을 지키게 압박을 조금 가할 필요가 있다.

**따라서 추가된 표준은 “어떻게 코드 리뷰를 할 것인가?” 이다.**

- `페이컨 검사` 같은 기법으로 리뷰 절차 공식화 할 수도 있다
- Pull Request 사용해 제출 할 수도 있다.
- Intellij의 `UpSource` 를 사용을 고려해 본다.

짝 프로그래밍을 이용한 리뷰

- 잘 되면 짝 프로그래밍은 한 명이 했을 때보다 설계가 좋고, 한 명보다는 두 명이 함께 하는것이 낫다는 해법을 만든다.
- 최상의 리뷰는 코드를 깊이 이해한 사람에게서 나오는데, 회사에는 그럴 시간적 여유가 없다. 따라서 리뷰는 바라는 것보다 더 적은 결함을 찾게 되며, 사후 리뷰는 가치가 있지만 들이는 노력만큼 그 가치가 높지는 않다.
- 또한 사후 리뷰는 심각한 문제를 고치는 데 너무 늦다. 코드를 완전히 되돌리거나, 재작업하는 것을 부담스러워 한다.
- 하지만 모든 사람을 위한 것은 아니다. 다른 개발자와 하루 종일 가까이 일하기 때문이다.

CI는 코드를 더 자주 통합하고 그 결과를 매번 검증하는 것을 말한다.

코드를 변경점과 합쳤을 때 동작하지 않는다는 것을 빨리 알수록 팀 성과는 더 좋아진다.

CI의 실천은 지속적 통합 서버라고 하는 도구의 지원을 받아야 한다. CI서버는 소스 저장소를 모니터링 한다.

요즘 CI 서버의 사용은 기본이다.

자바와 잘 동작하는 수많은 CI 도구를 찾을 수 있다.

**[코드 커버리지]**

- 코드 커버리지는 단위 테스트가 실행한 코드의 전체 퍼센트를 측정하는 것이다.

그러면 코드 커버리지는 어느 정도여야 하는가?

표면적으로 더 높은 코드 커버리지가 좋고, 낮은 커버리지는 나쁜 것 같다.

커버리지 개념은 오로지 속임수를 써야만 100%에 도달할 수 있다는 제한이 내제되어 있다.

인자 없는 생성자는 테스트 코드에서 직업 호출 하지 않기 때문에 코드 커버리지에 포함되지 않는다.

그래서 100% 맞추기 위해서 단지 클래스만 인스턴스화 시키는 단위 테스트 작성을 할 수도 있다.

설계가 좋을 수록 테스트 작성도 쉬워진다.

의지가 반영된 좋은 설계는 더 적은 결함으로 이끄는 100% 커버리지에 도달할 수 있게 한다.

실제로는 100% 안 되지만 괜찮다.

TDD 수행하는 개발자는 일반적으로 정의상 90%를 초과 달성한다.

테스트를 자기 충족적인 예언으로 만든다.

커버리지만 높다고 좋은 것이 아니라 이해하고 유지 보수하기 어려우며 가치 있는 Assertion을 포함하지 않는 나쁜 테스트를 작성했을 수도 있다.

코드 커버리지 숫자는 그 자체로 큰 의미가 없다. 하지만 코드 커버리지의 추세는 중요하다. 팀은 시간이 지나면서 커버리지 퍼센트가 높아져야 하고 적어도 아래 방향으로 내려가면 안된다.