<Chapter 7> 경계 조건: CORRECT 기억법

경계 조건은 자주 작은 결함들을 만들어 내는 곳이다.

- 단위 테스트는 종종 **경계 조건**들에 관계된 결함들을 미연에 방지하는데 도움이 된다.
  경계 조건은 행복 경로(happy path) 의 끝에 있는 것으로 자주 문제가 발생한다.
  **아래는 단위 테스트를 만들때 고려해야할 경계 조건을 생각하는데 도움이 된다.**
    - **Conformance**(준수) : 값이 기대한 양식을 준수하는지
    - **Ordering**(순서) : 값의 집합이 적절하게 정렬되거나 정렬 되지 않았는지
    - **Range**(범위) : 이성적인 최솟값과 최댓값 안에 있는지
    - **Reference**(참조) : 코드 자체에서 통제할 수 없는 어떤 외부 참조를 포함 하는지
    - **Existence**(존재) : 값이 존재하는지 (null/nonnull, 0인지, 집합에 존재하는지)
    - **Cardinality**(기수) : 정확히 충분한 값들이 있는지
    - **Time**(절대적/상대적 시간) : 모든 것이 순서대로 일어나는지
- 잘못될 수 있는 어떤 것이라도 떠오르면 테스트 이름을 적어두고 살을 붙혀라.

1. **Conformance (준수)**
- 이메일 주소, 전화번호, 계좌번호, 파일 이름 등 기대하는 구조에 입력 데이터가 맞는지 확인할 수 있는 방법을 더 많이 생각해 봐야 한다.
- 그러면 언제 테스트 작성을 중단해야 할까?

  → 시스템의 데이터 흐름을 이해하여 시스템에 그 필드가 처음 입력될때 검증한다면 필드를 argument로 넘길때 마다 검사하지 않아도 된다. (불필요한 검사 최소화 가능하다)


2. **Ordering (순서)**
- 데이터 순서 또는 커다란 컬렉션에 있는 데이터 하나의 위치가 올바른지 확인해라

3. **Range (범위)**
- 정상적인 범주를 초과하는 값이나 음수인 값 같은 것들을 검사해주어야 한다.
- 기본형을 클래스로 만들어서 값을 Validate 할 수 있다.
- @AfterEach를 사용해 테스트가 완료되었을 때마다 제약사항들을 확인할 수 있다.

4. **Reference (참조)**
- 어떤 메서드를 테스트 할 때는 다음을 고려해야 한다.
    - 범위를 넘어서는 것을 참조하고 있지 않은지
    - 외부 의존성은 무엇인지
    - 특정 상태에 있는 객체를 의존하고 있는지
    - 반드시 존재해야 하는 그 외 다른 조건들
- 예를 들어, 고객의 계정 히스토리를 표시하는 웹 앱은 고객이 먼저 로그인 해야하고, stack에서 pop하려면 값이 비어 있으면 안된다.
- 어떤 상태에 대해 가정할 때는 그 가정이 맞지 않으면 코드가 합리적으로 잘 동작하는지 검사해야 한다.

5. **Existence (존재)**
- 주어진 값이 존재하는지 물어봄으로써 많은 잠재적인 결함을 발견할 수 있다.
- 어떤 인자를 허용하거나 필드를 유지하는 메서드에 대해 그 값이 null, 0 혹은 비어 있는 경우라면 어떤 일이 일어날지 생각해 봐라.
- 호출된 메서드가 null을 반환하거나, 기대하는 파일이 없거나, 네트워크가 다운되었을 때 어떤 일이 일어나는지 확인하는 테스트를 작성하라.

6. **Cardinality (기수)**
- 숫자 세기를 잘 해라.
- 0, 1, n (1보다 많은 다수) 의 케이스를 생각해라.
- 테스트 코드는 0, 1, n이라는 경계 조건에만 집중하고 n은 비즈니스 요구 사항에 따라 바뀔 수 있다.

7. **Time (시간)**
- 시간에 관해 다음에 담아 두어야 할 측면 몇개는 다음과 같다
    - 상대적 시간 (시간 순서)
    - 절대적 시간 (측정된 시간)
    - 동시성 문제들
- 메서드간의 호출 순서를 생각해 봐라. 예를들어, `login()` 은 `logout()` 메서드에 앞서 호출되어야 한다. 첫 번째와 마지막 순서의 중간을 생략해 봐라. 메서드의 호출 순서도 중요하다.
- 시간은 국제 표준시 (UTC), 일광시간절약제(DST) 마다 다르다.
    - 따라서 시간에 민감한 테스트는 이러한 경계 조건에 해당하는 날들을 확실하게 확인해야 한다.
    - 테스트 실패에 대한 또 다른 해결책은 시스템 시간에 의존하는 테스트를 작성해 테스트 코드에 통제할 수 있는 곳에서 얻어 오는 시간을 사용하도록 애플리케이션을 변경한다.
- 동시에 같은 객체를 다수 스레드가 접근하면 어떤 일이 일어나는지 확인해야함
    - 클라이언트에 동시성 요구 사항이 있따면 다수 클라이언트 스레드를 보여 주는 테스트를 작성할 필요가 있다.